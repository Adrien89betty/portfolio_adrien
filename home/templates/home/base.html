<!DOCTYPE html>
<html lang="en">
  <head>
    {% load static %}
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      {% block title %}
        Portfolio
      {% endblock %}
    </title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="{% static 'css/global_styles.css' %}" />
    {% block custom_css %}

    {% endblock %}
    {% block extra_head %}

    {% endblock %}
  </head>
  <body>
    <header>
      {% block nav %}
        <div class="navbar">
          <div class="nav-home">
            <a href="{% url 'home:index' %}">C:\</a>
          </div>
          <ul class="nav-links">
            <li>
              <a href="{% url 'about:about' %}">À propos</a>
            </li>
            <li>
              <a href="">Projets</a>
            </li>
            <li>
              <a href="">Contact</a>
            </li>
          </ul>
        </div>
      {% endblock %}
    </header>
    <main id="app">
      {% block content %}

      {% endblock %}
    </main>
    <footer>
      {% block footer %}
        <p>Loosely designed in Figma and coded in Visual Studio Code by yours truly. Built with Next.js and Tailwind CSS, deployed with Vercel. All text is set in the Inter typeface.</p>
      {% endblock %}
    </footer>
    <script>
      const app = Vue.createApp({
        data() {
          return {
            hardSkills: [],
            projects: [],
            hoveredProject: null,
            currentIndex: 0,
            interval: null,
          };
        },
        mounted() {
          // Fecth skills from the API
          fetch("/cv/api/skills/")
            .then((response) => {
              if (!response.ok) {
                throw new Error("Erreur dans la requête API");
              }
              return response.json();
            })
            .then((data) => {
              this.hardSkills = data;
            })
            .catch((error) =>
              console.error("Erreur lors du chargement des compétences :", error)
            );

          // fecth projects from the API
          fetch("/projects/api/projects/")
            .then((response) => response.json())
            .then((data) => {
              this.projects = Array.isArray(data) ? [...data] : [];
              setTimeout(() => {
                this.startAutoScroll();
              }, 1000); // Wait 1s before launching the auto scroll
            })
            .catch((error) =>
              console.error("Erreur lors du chargement des projets :", error)
            );
        },
        methods: {
          scrollCarousel(direction) {
            if (!this.projects.length) return;

            this.currentIndex += direction;

            // Infinite scroll (go back to the first project after the last one)
            if (this.currentIndex < 0) {
              this.currentIndex = this.projects.length - 1;
            } else if (this.currentIndex >= this.projects.length) {
              this.currentIndex = 0;
            }

            this.updateCarouselPosition();
          },

          // Starts auto scroll
          startAutoScroll() {
            if (this.interval) return; // Évite de créer plusieurs intervalles
            this.interval = setInterval(() => {
              this.scrollCarousel(1);
            }, 4000); // Défilement toutes les 5 secondes
          },

          // Stop auto scroll when mouse is hover the carousel
          stopAutoScroll() {
            clearInterval(this.interval);
            this.interval = null;
          },

          // Resume auto scroll when mouse leaves the carousel
          resumeAutoScroll() {
            if (!this.interval) {
              this.startAutoScroll();
            }
          },

          // Change slides directly via pagination
          goToSlide(index) {
            this.currentIndex = index;
            this.updateCarouselPosition();
          },

          // Update carousel position after a manual changes
          updateCarouselPosition() {
            const wrapper = document.querySelector(".carousel-wrapper");
            if (wrapper && wrapper.firstElementChild) {
              const itemWidth = wrapper.firstElementChild.offsetWidth + 20;
              wrapper.style.transform = `translateX(${-this.currentIndex * itemWidth}px)`;
            }
          },
        },
      });
      app.mount("#app");
    </script>
  </body>
</html>
