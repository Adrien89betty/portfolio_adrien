<!DOCTYPE html>
<html lang="en">
  <head>
    {% load static %}
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      {% block title %}
        Portfolio
      {% endblock %}
    </title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="{% static 'css/global_styles.css' %}" />
    {% block custom_css %}

    {% endblock %}
    {% block extra_head %}

    {% endblock %}
  </head>
  <body>
    <header>
      {% block nav %}
        <div class="navbar">
          <div class="nav-home">
            <a href="{% url 'home:index' %}"><img src="{% static 'home/images/house_icon.svg' %}" alt="Home button"></a>
          </div>
          <ul class="nav-links">
            <li>
              <a href="{% url 'about:about' %}">À propos</a>
            </li>
            <li>
              <a href="">Projets</a>
            </li>
            <li>
              <a href="">Contact</a>
            </li>
          </ul>
        </div>
      {% endblock %}
    </header>
    <main id="app">
      {% block content %}

      {% endblock %}
    </main>
    <footer>
      {% block footer %}
      <div class="footer-container">
        <div class="infos-links">
          <img src="{% static 'home/images/github_logo.svg' %}" alt="Github">
          <img src="{% static 'home/images/linkedin_logo.svg' %}" alt="Linkedin">
        </div>
        <p>Site web créé avec Django et Vue.js, hébergé sur Heroku.</p>
      </div>
      {% endblock %}
    </footer>
    <script>
      const app = Vue.createApp({
        data() {
          return {
            hardSkills: [],
            projects: [],
            hoveredProject: null,
            currentIndex: 0,
            interval: null,
            copied: false,
            contact: {
              name: "",
              email: "",
              message: ""
            },
            submitButtonText: "Envoyez votre message !"
          };
        },
        mounted() {
          console.log(this.submitButtonText)
          // Fecth skills from the API
          fetch("/cv/api/skills/")
            .then((response) => {
              if (!response.ok) {
                throw new Error("Erreur dans la requête API");
              }
              return response.json();
            })
            .then((data) => {
              this.hardSkills = data;
            })
            .catch((error) =>
              console.error("Erreur lors du chargement des compétences :", error)
            );

          // fecth projects from the API
          fetch("/projects/api/projects/")
            .then((response) => response.json())
            .then((data) => {
              this.projects = Array.isArray(data) ? [...data] : [];
              setTimeout(() => {
                this.startAutoScroll();
              }, 1000); // Wait 1s before launching the auto scroll
            })
            .catch((error) =>
              console.error("Erreur lors du chargement des projets :", error)
            );
        },
        methods: {
          scrollCarousel(direction) {
            if (!this.projects.length) return;

            this.currentIndex += direction;

            // Infinite scroll (go back to the first project after the last one)
            if (this.currentIndex < 0) {
              this.currentIndex = this.projects.length - 1;
            } else if (this.currentIndex >= this.projects.length) {
              this.currentIndex = 0;
            }

            this.updateCarouselPosition();
          },

          // Starts auto scroll
          startAutoScroll() {
            if (this.interval) return;
            this.interval = setInterval(() => {
              this.scrollCarousel(1);
            }, 3000);
          },

          // Stop auto scroll when mouse is hover the carousel
          stopAutoScroll() {
            clearInterval(this.interval);
            this.interval = null;
          },

          // Resume auto scroll when mouse leaves the carousel
          resumeAutoScroll() {
            if (!this.interval) {
              this.startAutoScroll();
            }
          },

          // Change slides directly via pagination
          goToSlide(index) {
            this.currentIndex = index;
            this.updateCarouselPosition();
          },

          // Update carousel position after a manual changes
          updateCarouselPosition() {
            const wrapper = document.querySelector(".carousel-wrapper");
            if (wrapper && wrapper.firstElementChild) {
              const itemWidth = wrapper.firstElementChild.offsetWidth + 20;
              wrapper.style.transform = `translateX(${-this.currentIndex * itemWidth}px)`;
            }
          },

          // Email copy feature in contact section
          copyEmail() {
            const emailText = "adrienleveille.contact@gmail.com";
            navigator.clipboard.writeText(emailText).then(() => {
              this.copied = true;

              setTimeout(() => {
                this.copied = false;
              }, 2000);
            }).catch(err => console.error("Erreur lors de la copie :", err));
          },
        }
      });

      app.mount("#app");
    </script>
  {% block extra_js %}
  {% endblock %}
  </body>
</html>
